<div class="row param-row pt-4">
  <div class="col">
    <p>Paramétrage des employés</p>
  </div>
  <div class="col text-right">
    <button type="button" class="btn btn-light" (click)="reinitEmployes()">Réinitialiser</button>
  </div>
</div>
<hr>
<div class="row" *ngIf="modelLoaded">
  <div class="col">
    <form [formGroup]="employeForm" *ngIf="modelLoaded">
      <div formArrayName="employes">
        <accordion [closeOthers]="true">
          <accordion-group *ngFor="let employe of employeForm.controls.employes.controls" panelClass="acc-header">
            <div accordion-heading><strong>{{employe.controls.prenom.value}} {{employe.controls.nom.value}}</strong></div>
            <i *ngIf="!modelLoaded" class="fa fa-spinner fa-spin fa-fw"></i>

            <!-- Identité -->
            <div class="row">
              <div class="col form-group">
                <label>Nom</label>
                <input type="text" class="form-control" [formControl]="employe.controls.nom" />
              </div>
              <div class="col form-group">
                <label>Prénom</label>
                <input type="text" class="form-control" [formControl]="employe.controls.prenom" />
              </div>
            </div>

            <!-- Taux horaire -->
            <div class="row">
              <div class="col form-group">
                <label>Tx horaire HN BRUT</label>
                <input type="number" class="form-control" [formControl]="employe.controls.tauxHoraireNormalBrut" />
              </div>
              <div class="col form-group">
                <label>Tx horaire HN NET</label>
                <input type="number" class="form-control" [formControl]="employe.controls.tauxHoraireNormalNet" />
              </div>
              <div class="col form-group">
                <label>Tx horaire HC BRUT</label>
                <input type="number" class="form-control" [formControl]="employe.controls.tauxHoraireComplementaireBrut" />
              </div>
              <div class="col form-group">
                <label>Tx horaire HC NET</label>
                <input type="number" class="form-control" [formControl]="employe.controls.tauxHoraireComplementaireNet" />
              </div>
            </div>

            <!-- Indemnités -->
            <div class="row">
              <div class="col form-group">
                <label>Ind. KM</label>
                <input type="number" class="form-control" [formControl]="employe.controls.indemnitesKm" />
              </div>

              <div class="col form-group">
                <label>Ind. Entretien : MIN € &lt; Borne h &lt; MAX €</label>
                <div class="input-group">
                  <div class="input-group-prepend">
                    <span class="input-group-text">Min</span>
                  </div>
                  <input type="number" class="form-control" [formControl]="employe.controls.indemnitesEntretien.controls.indemniteInf" />
                  <div class="input-group-prepend">
                    <span class="input-group-text">&lt;</span>
                  </div>
                  <input type="number" class="form-control" [formControl]="employe.controls.indemnitesEntretien.controls.borne" />
                  <div class="input-group-append">
                    <span class="input-group-text">&lt;</span>
                  </div>
                  <input type="number" class="form-control" [formControl]="employe.controls.indemnitesEntretien.controls.indemniteSup" />
                  <div class="input-group-append">
                    <span class="input-group-text">Max</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Repas / CP -->
            <div class="row">
              <div class="col form-group">
                <label>Déjeuner</label>
                <input type="number" class="form-control" [formControl]="employe.controls.fraisDejeuner" />
              </div>
              <div class="col form-group">
                <label>Goûter</label>
                <input type="number" class="form-control" [formControl]="employe.controls.fraisGouter" />
              </div>
              <div class="col form-group">
                <label>Tx CP</label>
                <input type="number" class="form-control" [formControl]="employe.controls.tauxCongesPayes" />
              </div>
            </div>

            <!-- Actions -->
            <div class="row">
              <div class="col form-group text-right">
                <button class="btn btn-primary" (click)="saveEmploye(employe)"
                    [disabled]="employe.pristine || employe.controls.saved.value">
                  <span *ngIf="!employe.controls.saved.value">Enregistrer</span>
                  <span *ngIf="employe.controls.saved.value">Enregistré !</span>
                </button>
                <span class="delete-employe-link" (click)="deleteEmploye(employe.id, deleteModalTemplate)">Supprimer</span>
              </div>
            </div>
          </accordion-group>
        </accordion>
      </div>
    </form>
  </div>
</div>

<ng-template #deleteModalTemplate>
  <div class="modal-header">
    <h4 class="modal-title pull-left">Suppression</h4>
    <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()" [disabled]="toDelete.deleteEnCours">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <p>Voulez-vous vraiment supprimer <strong>{{toDelete.name}}</strong> du paramétrage ?</p>
    <div class="row">
      <div class="col text-right">
        <button type="button" class="btn btn-light" (click)="declineDeletion()" [disabled]="toDelete.deleteEnCours">Annuler</button>
        <button type="button" class="btn btn-danger" (click)="confirmDeletion(toDelete.deleteFunction, toDelete.id)"
          [disabled]="toDelete.deleteEnCours">
          <span><i *ngIf="toDelete.deleteEnCours" class="fa fa-spinner fa-spin fa-fw"></i></span>
          <span *ngIf="!toDelete.deleteEnCours">Supprimer</span>
        </button>
      </div>
    </div>
  </div>
</ng-template>
