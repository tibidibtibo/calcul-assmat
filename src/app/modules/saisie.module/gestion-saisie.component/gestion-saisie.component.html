<div>
  <h4>Gestion des saisies</h4>
  <form [formGroup]="form" (ngSubmit)="onSubmit()">
    <div class="row">
      <div class="col align-self-center form-group">
        <label for="mois">Mois</label>
        <select class="form-control" name="mois" id="mois" [(ngModel)]="monthSelected" formControlName="mois">
          <option *ngFor="let month of monthsList" [ngValue]="month">{{month}}</option>
        </select>
      </div>
      <div class="col align-self-center form-group">
        <label for="annee">Année</label>
        <input type="number" required minlength="4" class="form-control" name="annee" id="annee" [(ngModel)]="yearSelected"
          formControlName="annee" />
      </div>
      <div class="col align-self-center form-group">
        <button type="submit" [disabled]="form.invalid || loading" class="btn btn-success btn-lg">
          Rechercher <i class="fa fa-spinner fa-spin fa-fw" *ngIf="loading"></i>
          </button>
      </div>
    </div>
    <hr class="my-4">
  </form>
  <div *ngIf="!donneesSaisies || (donneesSaisies && donneesSaisies.length < 1)" class="alert alert-info">
    <h6>Aucune saisie trouvée.</h6>
  </div>
  <ul class="list-group" *ngIf="donneesSaisies">
    <li *ngFor="let saisie of donneesSaisies" class="list-group-item">
      <table class="table table-striped">
        <thead>
          <tr>
            <th scope="col">Date</th>
            <th scope="col">Enfant</th>
            <th scope="col">Employé</th>
            <th scope="col">Arrivée</th>
            <th scope="col">Départ</th>
            <th scope="col">Déjeuners</th>
            <th scope="col">Goûters</th>
            <th scope="col">AR école</th>
            <th scope="col">Autres km</th>
            <th></th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>{{ saisie.dateSaisie | date: "dd/MM/yyyy" }}</td>
            <td>{{ saisie.refEnfant.nom }}</td>
            <td>{{ saisie.refEmploye.nom }}</td>
            <td>{{ saisie.heureArrivee | date: "dd/MM/yyyy HH:mm" }}</td>
            <td>{{ saisie.heureDepart | date: "dd/MM/yyyy HH:mm" }}</td>
            <td>{{ saisie.nbDejeuner }}</td>
            <td>{{ saisie.nbGouter }}</td>
            <td>{{ saisie.nbArEcole }}</td>
            <td>{{ saisie.autreKm }}</td>
            <td><button class="btn btn-light" (click)="editSaisie(saisie)"><i class="fas fa-edit"></i></button></td>
            <td><button class="btn btn-danger" (click)="deleteSaisie(saisie, deleteModalTemplate)"><i class="fas fa-times"></i></button></td>
          </tr>
        </tbody>
      </table>
    </li>
  </ul>

  <ng-template #deleteModalTemplate>
    <div class="modal-header">
      <h4 class="modal-title pull-left">Suppression</h4>
      <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()" [disabled]="toDelete.deleteEnCours">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <p>Voulez-vous vraiment supprimer la saisie du <strong>{{ toDelete.date | date: "dd/MM/yyyy" }}</strong> pour <strong>{{ toDelete.nom }}</strong> ?</p>
      <div class="row">
        <div class="col text-right">
          <button type="button" class="btn btn-light" (click)="declineDeletion()" [disabled]="toDelete.deleteEnCours">Annuler</button>
          <button type="button" class="btn btn-danger" (click)="confirmDeletion(toDelete.deleteFunction, toDelete.id)"
            [disabled]="toDelete.deleteEnCours">
            <span><i *ngIf="toDelete.deleteEnCours" class="fa fa-spinner fa-spin fa-fw"></i></span>
            <span *ngIf="!toDelete.deleteEnCours">Supprimer</span>
          </button>
        </div>
      </div>

    </div>
  </ng-template>
</div>
